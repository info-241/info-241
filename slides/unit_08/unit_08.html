<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>w241: Experiments and Causality</title>
    <meta charset="utf-8" />
    <meta name="author" content="David Reiley, David Broockman, D. Alex Hughes" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# w241: Experiments and Causality
## Incomplete Control Over Treatment Delivery
### David Reiley, David Broockman, D. Alex Hughes
### UC Berkeley, School of Information
### Updated: 2021-06-14

---




class: inverse, center, middle 

#Introduction to Noncompliance

---
#Introduction

## Noncompliance in randomized experiments

Treatment assigned but not received

+ Knock on the door to discuss voting in upcoming election, but person doesn't answer

How to deal with noncompliance
+ Analyze data correctly (don't introduce bias)
+ Design experiments differently to improve precision

Remember the advertising experiments earlier in the course

One-sided noncompliance: subjects assigned to treatment don't receive

Two-sided noncompliance: Control subjects receive treatment

---
# Reading

## *Gerber and Green*: Chapter 5

Return when finished

---

&lt;!-- # Introduction to Heterogeneous Treatment Effects  --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Main Topics  --&gt;

&lt;!-- ## Heterogeneous treatment effects --&gt;
&lt;!-- - Does the same same treatment have different effects on different subjects?  --&gt;
&lt;!-- - Use of regression to measure HTEs: Interaction between covariates of interest and treatment variable  --&gt;

&lt;!-- ## Data analysis with non-experimental control --&gt;
&lt;!-- - Multiple comparisons problem: Fishing expeditions can cause overstatement of true statistical significance. --&gt;


&lt;!-- --- --&gt;

&lt;!-- # Reading  --&gt;

&lt;!-- ## Reading: *Field Experiments*  --&gt;
&lt;!-- Please read --&gt;

&lt;!-- - Section 9.0 (the Introduction), and,  --&gt;
&lt;!-- - Section 9.1  --&gt;

&lt;!-- --- --&gt;

&lt;!-- class: inverse, center, middle  --&gt;

&lt;!-- # Motivating Examples of Heterogeneous Treatment Effects  --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Quiz Question Discussion --&gt;

&lt;!-- - Potential outcomes are hypothetical population parameters. --&gt;
&lt;!-- - In real-world samples, we get to measure only --&gt;
&lt;!--   - Treatment outcomes for the treatment group --&gt;
&lt;!--   - Control outcomes for the control group --&gt;
&lt;!-- - We can measure only treatment outcomes or control outcomes for a single person. --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Reading  --&gt;

&lt;!-- ## Reading: *Field Experiments*, Section 9.3.1 --&gt;

&lt;!-- While reading, consider, "Do different groups have different treatment effects?" --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Example: Electricity Consumption --&gt;

&lt;!-- ## Test Groups --&gt;
&lt;!-- 1. Below-average; and,  --&gt;
&lt;!-- 2. Above-average electricity consumers --&gt;

&lt;!-- ## Treatment  --&gt;
&lt;!-- - Social comparison --&gt;
&lt;!-- - How much electricity are your neighbors using?  --&gt;

&lt;!-- ## HTE --&gt;
&lt;!-- - Are people who use a *lot* of energy more responsive than people who aren't using much energy?  --&gt;
&lt;!-- - Are people who are using less than their neighbors going to start using more?  --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Example: Congressional Responsiveness --&gt;

&lt;!-- ## Test groups --&gt;
&lt;!-- 1. Members of Congress from the North; and,  --&gt;
&lt;!-- 2. Members of Contress from the South --&gt;

&lt;!-- ## Treatment  --&gt;
&lt;!-- - Being informed of a meeting with a donor versus a constituent --&gt;

&lt;!-- ## HTE --&gt;
&lt;!-- - Responsiveness of different congressmen --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Example: eBay Shipping Policies  --&gt;

&lt;!-- ## Test groups  --&gt;
&lt;!-- - Buyers of high-priced items  --&gt;
&lt;!-- - Buyers of low-priced items --&gt;

&lt;!-- ## Treatment --&gt;
&lt;!-- - Charging (or not charging) a shipping price on an auction --&gt;
&lt;!-- Some measure of value should be predetermined before the experiment --&gt;

&lt;!-- ## HTE --&gt;
&lt;!-- - Responsiveness to shipping costs on high-value versus low-value items --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Example: eBay Seller Reputation --&gt;

&lt;!-- ## Test Groups  --&gt;
&lt;!-- - Buyers of high-priced items  --&gt;
&lt;!-- - Buyers of low-priced items --&gt;

&lt;!-- ## Treatment  --&gt;
&lt;!-- - Selling from a high- or low-reputation account  --&gt;

&lt;!-- ## HTE --&gt;
&lt;!-- - Are people differently reactive to reputation when they are buying high-priced, rather than low-priced items?  --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Example: Donation Matching  --&gt;

&lt;!-- ## Test Groups  --&gt;
&lt;!-- - People who live in *Blue States*  --&gt;
&lt;!-- - Peolpe who live in *Red States*  --&gt;

&lt;!-- ## Treatment  --&gt;
&lt;!-- - Informing individuals that a donation they make to the ACLU will be matched  --&gt;

&lt;!-- ## HTE  --&gt;
&lt;!-- - Because the ACLU is perceived to be a "Liberal" non-profit organization, do individuals who live in areas that are more liberal react more strongly to the donor-matching treatment?  --&gt;

&lt;!-- --- --&gt;

&lt;!-- class: inverse, center, middle  --&gt;

&lt;!-- # Treatment-by-Covariate Interactions  --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Quiz Review  --&gt;

&lt;!-- ## Answer --&gt;
&lt;!-- - Students whose parents' literacy was above the median --&gt;

&lt;!-- ## Discussion  --&gt;
&lt;!-- - Treatment effect not statistically significantly different between students whose parents have above-median versus below-median literacy --&gt;
&lt;!-- - We need to know standard errors in order to evaluate how much to believe a point estimate --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Estimating HTEs --&gt;

&lt;!-- ## Etimating with two samples  --&gt;

&lt;!-- - Split data into two separate samples --&gt;
&lt;!-- - Compute means and standard errors of the treatment effect in each group --&gt;
&lt;!--   - Do a two-sample test of means. --&gt;
&lt;!--   - **Group one**: Students whose parents have above-median literacy --&gt;
&lt;!--   - **Group two**: Students whose parents have below-median literacy --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Estimating HTEs (cont'd)  --&gt;

&lt;!-- ## Estimating with regression  --&gt;
&lt;!-- - Estimate a regression with dummy variables  --&gt;
&lt;!--   - `\(I\)` indicator for teacher incentive treatment  --&gt;
&lt;!--   - `\(P\)` indicator for parents with above-average literacy  --&gt;
&lt;!-- - Include an interaction between `\(I \times P\)` --&gt;

&lt;!-- `$$Y_{i} = \beta_{0} + \beta_{1} I_{i} + \beta_{2} P_{i} + \beta_{3} (I_{i} \times P_{i}) + \epsilon_{i}$$` --&gt;
&lt;!-- ## Inferences  --&gt;
&lt;!-- - Test whether there is evidence that the interaction term is different from zero --&gt;
&lt;!--   - `\(H_{0}\)`: The treatment effects are no different between the groups  --&gt;
&lt;!--   - `\(H_{A}\)`: The treatment effects are different between the groups --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Reading Clarification  --&gt;

&lt;!-- - Always present standard errors with point estimates. --&gt;
&lt;!-- - Always show the number of observations. --&gt;
&lt;!-- - Reports the coefficient on one row, and the standard error in parentheses on the row below --&gt;
&lt;!-- - Includes a reporting of:  --&gt;
&lt;!--   - The number of observations --&gt;
&lt;!--   - The `\(R^2\)` and *F-Test* vs. an intercept-only model --&gt;

&lt;!-- --- --&gt;

&lt;!-- class: center --&gt;

&lt;!-- ## Standard Format of Results  --&gt;

&lt;!-- ```{r, echo = FALSE} --&gt;
&lt;!-- d &lt;- data.frame(x = runif(n = 100, min = 0, max = 10)) --&gt;
&lt;!-- d$y &lt;- 1 + d$x + rnorm(n = 100) --&gt;

&lt;!-- model &lt;- lm(y ~ x, data = d) --&gt;

&lt;!-- stargazer::stargazer( --&gt;
&lt;!--   model, type = 'text', --&gt;
&lt;!--   covariate.labels = 'Treatment',  --&gt;
&lt;!--   dep.var.labels = 'Score',  --&gt;
&lt;!--   omit.stat = c('ser'),  --&gt;
&lt;!--   digits = 2) --&gt;
&lt;!-- ``` --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Reading Clarification (cont'd)  --&gt;

&lt;!-- `$$\widehat{Y}_{i} = \beta_{0} + \beta_{1} I_{i} + \beta_{2} P_{i} + \beta_{3} (I_{i} \times P_{i})$$` --&gt;

&lt;!-- - If a test for `\(\beta_{3}\)` rejects the null hypothesis, then treatment effects differ along with levels of the covariate --&gt;
&lt;!-- - Possible to estimate this with regression or randomization inference  --&gt;
&lt;!--   - Gerber and Green use randomization inference,  --&gt;
&lt;!--   - With data that is well-behaved, we can rely on the Central Limit Theorem and use regression --&gt;

&lt;!-- --- --&gt;

&lt;!-- class: inverse, center, middle  --&gt;

&lt;!-- # Teacher Incentives: Evidence from India --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Example: Teacher Incentives  --&gt;

&lt;!-- ## [Muralidharan and Sundararaman (2011)](https://www.jstor.org/stable/10.1086/659655) --&gt;

&lt;!-- ![header text](./figures/teacher_incentives_header.png) --&gt;
&lt;!-- --- --&gt;

&lt;!-- # School Enrollments  --&gt;

&lt;!-- ![enrollments table](./figures/hte_school_enrollment.png) --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Data Structure: Teacher Gender  --&gt;

&lt;!-- | Test Score | Male Teacher | Incentive | Interaction |  --&gt;
&lt;!-- |------------|--------------|-----------|-------------| --&gt;
&lt;!-- | 10         | 1            | 1         | 1           | --&gt;
&lt;!-- | 12         | 1            | 0         | 0           |  --&gt;
&lt;!-- | 8          | 0            | 1         | 0           |  --&gt;
&lt;!-- | 14         | 0            | 0         | 0           |  --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Results: Teacher Gender  --&gt;

&lt;!-- ![student characteristics table](./figures/hte_male_student.png) --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Estimating Equation  --&gt;

&lt;!-- $$\begin{aligned}  --&gt;
&lt;!--   T_{ijkm}(Y_{n})  = \alpha &amp;+ \gamma T_{ijkm}(Y_{0}) + \delta_{1} Incentives_{i} \\  --&gt;
&lt;!--     &amp; + \delta_{2} Characteristic_{i} \\  --&gt;
&lt;!--     &amp; + \delta_{3} (Incentives_{i} \times Characteristic_{i}) \\  --&gt;
&lt;!--     &amp; + \beta Z_{m} + \epsilon_{k} + \epsilon_{jk} + \epsilon_{ijk} --&gt;
&lt;!-- \end{aligned}$$ --&gt;

&lt;!-- - `\(T\)` is a test score taken in year Y  --&gt;
&lt;!-- - `\(Z_{m}\)` are covariates that are used to increase efficiency of the estimate --&gt;
&lt;!-- - Subscripts are:  --&gt;
&lt;!--   - `\(i\)` indexes the student, `\(j\)` the grade, and `\(k\)` the school, and `\(m\)` mandal --&gt;
&lt;!--   - `\(n\)` year of observation --&gt;

&lt;!-- ## Regressors of interest  --&gt;

&lt;!-- - Incentives  --&gt;
&lt;!-- - Characteristics --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Reading Regression Results  --&gt;

&lt;!-- - Each column represents a separate regression estimate --&gt;
&lt;!--   - **Dependent Variable**: Students' test score after treatment, normalized by the standard deviation across students --&gt;

&lt;!-- ![student characteristics table](./figures/hte_male_student.png) --&gt;

&lt;!-- - If a male student started at the 50th percentile, the treatment would have increased him to the 59th percentile. --&gt;
&lt;!-- - No compelling evidence that treatment works differently for male or female identifying students - no HTE --&gt;

&lt;!-- --- --&gt;

&lt;!-- class: inverse, center, middle  --&gt;

&lt;!-- # HTEs by Student Characteristics --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Quiz Review  --&gt;

&lt;!-- - Asterisks help reader pick out statistically significant effects --&gt;
&lt;!-- - Most columns had statistically significant treatment effects... --&gt;
&lt;!-- - ... but no statistically significant HTEs --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Household Wealth Interaction Effect --&gt;

&lt;!-- - Only the household affluence interaction term was statistically significant. --&gt;
&lt;!-- - Household affluence variable is difficult to interpret. --&gt;
&lt;!--   - Interaction coefficient = `0.038 **` --&gt;
&lt;!--   - Treatment effect increases by 0.038 for each additional point of household-affluence score. --&gt;
&lt;!--   - *Household-affluence score* ranges from 0–7 --&gt;
&lt;!--   - Assumes all categories have equal treatment-effect benefits -- `\(1 \rightarrow 2 = 6 \rightarrow 7\)` --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Alternative Specification  --&gt;

&lt;!-- ## Rather than a linear scale, allow multiple dimensions of wealth  --&gt;

&lt;!-- - Seven separate dummy variables as covariates. --&gt;
&lt;!--   - One for owning land --&gt;
&lt;!--   - One for owning a house --&gt;
&lt;!--   - One for having running water --&gt;
&lt;!--   - One for owning a TV --&gt;
&lt;!-- - And then, seven different interaction terms. --&gt;

&lt;!-- --- --&gt;

&lt;!-- # One Regression to Rule Them All?  --&gt;
&lt;!-- ## Several specific regressions or one big regression? --&gt;

&lt;!-- - Muralidharan and Sundararaman (2011) Used one column for each covariate --&gt;
&lt;!--   - Each covariate could have been put into the same regression. --&gt;
&lt;!--   - But, might be difficult to identify *each* effect, since covariates are not randomly-assigned  --&gt;
&lt;!--   - As a result, many of the covariates might covary with others, and so lead to "unstable" estimates  --&gt;
&lt;!--   - This instability is because one measure is picking up many, related effects --&gt;

&lt;!-- ## Colinearity isn't a problem with treatment variables  --&gt;

&lt;!-- - Because the experiment has randomly assigned treatment, it should be independent from all sets of covariates --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Teacher Incentives: Household Affluence  --&gt;

&lt;!-- ![household affluence](./figures/hte_household_affluence.png) --&gt;

&lt;!-- - Adding household affluence leads the reported effect on `Incentive` to shrink --&gt;
&lt;!--   - Estimated overall ATE = `\(3.5\)` (average affluence) `\(\times 0.038 = 0.133\)`  --&gt;
&lt;!--   - (Note, this would only be the case if there was a uniform distribution, or symmetric distribution across the affluence scale) --&gt;
&lt;!--   - Incentive + estimated overall ATE `\(0.09 + 0.133 = 0.223\)` --&gt;
&lt;!-- - In an interaction model, the effect of treatment depends on levels for interacted variables   --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Teacher Incentives: Parental Literacy --&gt;

&lt;!-- ![parental literacy](./figures/hte_parental_literacy.png) --&gt;

&lt;!-- - Always be aware of the amount of statistical uncertainty in estimates --&gt;
&lt;!--   - Confidence interval: `\(−0.003 \pm 0.038\)` per unit of literacy --&gt;
&lt;!--   - The largest absolute value in that interval is `\(-0.003 - 0.038 = -0.041\)`. --&gt;
&lt;!-- - Even using the coefficient estimate with the largest magnitude `\(-0.041\)` and evaluating it at the largest parental literacy value, `\(4\)`, the estimated total interaction effect confidence interval is `\(-0.041 \times 4 = -0.16\)` --&gt;
&lt;!-- - This is still smaller than the baseline treatment effect, `\(0.224\)` for those with totally parents marked as a zero on literacy --&gt;

&lt;!-- --- --&gt;
&lt;!-- class: center, middle --&gt;

&lt;!-- ## Always look at the magnitude of the estimate!  --&gt;
&lt;!-- ## Always look at size of the confidence interval! --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Broad based Treatment Effect  --&gt;

&lt;!-- ![overall effect](./figures/broadbased_effects.png) --&gt;

&lt;!-- --- --&gt;

&lt;!-- class: inverse, center, middle --&gt;

&lt;!-- # HTEs by Teacher Characteristics --&gt;

&lt;!-- ---  --&gt;

&lt;!-- # Review: Student Characteristic HTE --&gt;

&lt;!-- - Broad-based benefits from teacher incentive program were found. --&gt;
&lt;!--   - No HTEs by past student test score --&gt;
&lt;!--   - Household wealth was the only significant HTE interaction. --&gt;

&lt;!-- --- --&gt;

&lt;!-- # Teacher Characteristics --&gt;

&lt;!-- Review the table. --&gt;
&lt;!-- Answer the quiz questions. --&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
