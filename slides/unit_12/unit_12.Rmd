---
title: "w241: Experiments and Causality"
subtitle: "Attrition, Mediation, and Generalizability"
author: "David Reiley, David Broockman, D. Alex Hughes"
institute: "UC Berkeley, School of Information"
date: "Updated: `r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: [default, metropolis, metropolis-fonts] 
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, echo=FALSE, message=FALSE, include=FALSE}
library(latex2exp)
library(tidyverse)
library(ggplot2)
library(patchwork)
library(data.table)

berkeley_blue   <- '#003262'
california_gold <- '#FDB515'

options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = TRUE, dpi = 300, fig.height = 3)


theme_set(theme_minimal())
```

class: inverse, center, middle 

# Introduction: 
## .center[Attrition, Mediation, and Generalizability]
<br>
<br>  
DATASCI W241: Experiments and Causality


---
# Attrition
### **Definition:** Outcomes for all subjects cannot be measured in an experiment
- The $Y$ value may be missing for some subjects
- Why could attrition happen?

---
#Example: Causes of Attrition

- Imagine studying a medicine that lowers blood pressure and therefore saves lives
- Groups
  - Treatment = 1
  - Control = 0
  - People present in both groups


---
#Example: Causes of Attrition

| Group | Status  | Blood Pressure |
|-------|---------|----------------|
|   0   | Alive   |   70    |
|   0   | Dead    |   ?     |
|   0   | Dead    |   ?     |
|   1   | Alive   |   100   |
|   1   | Alive   |   90    |
|   1   | Alive   |   80    |



---
#Example: Causes of Attrition
- Comparing mean of both groups may lead to an incorrect conclusion that this drug **raises** blood pressure
  - Mean in treatment group: 90
  - Mean in control group: 70
- Apples-to-apples comparison lost due to attrition
- Must consider how people came to have $x$ values that may be used as comparisons
- If subjects are lost from control group then the apples-to-apples copmarison may be lost 
- In this example: B
  - Blood pressure comparisons between treatment and control groups cannot be made due to deaths in the control group
  - Poor-quality trial for assessing the effects of this drug on blood pressure
  
  
---
# Easy Example: Attrition by Movement

- We have individual tax returns from cities
- Experiment: What happens if we raise tax rate in cities?
- Concern: if taxes go up, people may have reduced incentive to work
- Due to higher taxes in some cities, people might move away
- Many cities in state, experiment only run in a portion of them
- People move out of the treatment cities where taxes are raised, cannot be observed
- No longer apples-to-apples comparision
- Cannot only look at the people who stayed
  - We don't know who in the treatment or control groups would have stayed and been observable
  - Without knowing who is observable and who is not, we can't be sure that we are going to conduct an apples-to-apples comparison
- Example: Massachusetts and New Hampshire
  - Many high income people have moved just into New Hampshire
  - Along border, high income people tend to be in New Hampshire and low income people in Massachusetts
  - We don't want to assess that living there are huge benefits to living in New Hampshire because people tend to be much richer
  
  
---
# Harder Example: Attrition by Movement
- We have city-level data of total hours worked in one year for all jobs
- Some cities implement a policy to raise taxes
- Question: do higher taxes lead people to work less?
- May not see attrition in data received
  - Eg. City may give only total numbers of hours worked for all jobs
- Derease in total hours worked in a treatment city may be driven by people moving away, not by people working fewer hours
- In this example, we only see aggregate hours worked, so we don't even know that there are people missing/attrition has occurred
- Tests for differential attrition may not illustrate that attrition is occurring
- Important to consider conclusions when people opt out of being measured in an experiment
- This experiment *WILL* answer what determines how many hours are worked in a city in a given year
- This experiment *WILL NOT* answer what someone's individual behavior is becaue of differential attrition


---
# Attrition by Survey Nonresponse
###Most common cause of attrition  

**Example:** Obama campaign asked "What is the effect of making phone calls to convince people to re-elect Barack Obama?"


---
# Attrition by Survey Nonresponse
## Scenario #1
<br>

| Democrat | Monday Obama Call | Answers Tuesday Survey | Obama Vote |
|-----|-------------------|------------------------|------------|
| 0 | 0 | 1 | 0 |
| 0 | 0 | 1 | 0 |
| 0 | 1 | 0* | 0 |
| 0 | 1 | 0* | 0 |

\*Indicates that individidual *did not* respond to Tuesday survey
- In this scenario:
  - People in the treatment group *did not* answer the survey 
  - People in the control group *did* answer the survey


---
# Attrition by Survey Nonresponse
## Scenario #2
<br>

| Democrat | Monday Obama Call | Answers Tuesday Survey | Obama Vote |
|-----|-------------------|------------------------|------------|
| 1 | 0 | 0* | 1 |
| 1 | 0 | 0* | 1 |
| 1 | 1 | 1 | 1 |
| 1 | 1 | 1 | 1 |
\*Indicates that individidual *did not* respond to Tuesday survey

- In this scenario:
  - People in the treatment group *did* answer the survey 
  - People in the control group *did not* answer the survey


---
# Attrition by Survey Nonresponse
- In both scenarios, we have no treatment effect by making the calls
- Everyone in the treatment group who answered the survey is a Democrat
  - Obama support in treatment group: 100%
- Everyone in the control group who answered the survey is a Republican
  - Obama support in control group: 0%
- Calls *appear* to be extremely effective based on results
  - Everyone in treatment group *who answered the survey* said they would vote for Barak Obama
  - Everyone in the control group *who answered the survey* said they would vote for Mitt Romney
- Attrition caused misleading results
  - It appears that just calling people will convince all of them to vote for Barack Obama
  - In reality, calls (treatment) didn't change minds; they only changed who responded to the survey



---
class: inverse, middle, center
# Detecting and Preventing Attrition

---
# Average Attrition

#### "Average treatment effect" on ability to measure the outcome
- Possible test: Code 1 or 0 outcome variable to determine if the outcome was observable  
- Is the measurement rate of the outcome the same in treatment and control?
- Possible test: simple regression of response to survey on treatment assignment
  - On average, are people more or less likely to be observable in treatment or control?
  - This test may detect some types of differential attrition
  
#### No (zero) average differential attrition can conceal big differential attrition
- Eg. Obama call campaign example from last section:
  
  
|             | Control | Treatment |
|-------------|---------|-----------|
| Democrats   |   0%    |   100%    |
| Republicans | 100%    |     0%    |
| Average     |  50%    |    50%    |


---
# Balance on Ex Ante Covariates
## .center[Across Treatment Groups]

#### Is there some indication that different groups were more or less likely to be observable differentially in treatment or control?
- Check for balance on ex ante covariates across treatment groups
- Example: Obama campaign has 100,000 phone numbers they intend to call
  - There is an equal distribution of Republicans and Democrats among the people they are calling
  - Campaign conducts treatment and surveys
  
#### Is there, on average, a similar likelihood of being a Democrat among those who answered the survey in both treatment and control?
- No, this test would fail. There are more Democrats in the treatment group than the control group
- May wrongly estimate the effect of treatment on the outcome


---
# Balance on Ex Ante Covariates
## .center[Across Treatment Groups]
In a political example, look for differences in income or political party
  - If treatment causes Republicans to attrit (leave the sample), party affiliation will no longer be balanced in the final sample

$$P \supset Q \rightarrow \sim Q \supset \sim P$$ but not $$  \sim P \supset  \sim Q$$
---
# Differential Attrition Concealed
#### Although something could be diagnostic of differential attrition, differential attrition may still exist
- There could see there is no average differential attrition and observable covariates are still balanced **BUT**

#### There could be differential attrition in something you can't measure
- There might be differential attrition due to the treatment
- Especially applies in political and commercial examples when:
  - People voluntarily agree to be measured
  - Treatment may change some peoples' behavior
- We may not be able to observe all the reasons why people chose to take or not to take our survey


---
# Differential Attrition Concealed
#### Generally:
- Attrition can make us worried
- If attrition happens randomly across treatment and control and treatment groups is fine
- The population in the control is the same as the population in the treatment, even though attrition has occurred
- However, we don't know if it is actually random
  - In the Obama survey case it was not random 
  - There was differential attrition by party

#### A simple way to look at this: Is the average attrition different across groups?
- If we have 80% response from the treatment group and only 50% from the control group, we're going to get different populations
- Even though there is 50% attrition in both treatment and control, you can still have a completely different composition of Republicans and Democrats in the groups
- Initial conclusion: Treatment was very effective (calls convinced people to vote for Obama)
- Looking at the covariate balance revealed this was a false conclusion
- Differential attrition can be totally undetectable, even when it biases your conclusions


---
# Avoiding Attrition with Surveys

### Conceal the purpose of the survey
- Convince people to take the survey without knowing it is related to a treatment they have already received
- In the political calls example, you could ask other questions about other things going on in their state first

### Increase response rate over all
- More likely to get more representative sample when response rate is higher
- For example, people are more likely to answer face-to-face surveys because they don't want to be rude 
- **Example:** YouTube ads replaced surveys so that people must take the survey
- Also eliminated differential attrition
- If forced to take the survey, less liekly to take due to treatment

### Secure commitments from subjects
- Only do randomized treatment and control groups within those who have committed to take survey

---
# Other Methods to Avoid Attrition

### Locate a subject pool unlikely to attrit
- In the income tax study you could choose subjects less likely to move, such as:
  - Subjects over 65
  - Subjects with children
  
### Consider other measurement strategies
- **Example:** study using website survey
- One option is to call everyone who saw the ad and ask if they purchased the product
- A better option is to measure conversions on a website
  - With this, someone would have to clear the cookies on their computer to attrit
  - After seeing the ad, people are less likely to clear their cookies than if asked to answer a survey
- We are more worried about differential attrition in the case of surveys, where people are actively deciding whether to answer, than in the case of website conversions, where the data is being collected passively



---
class: inverse, middle, center
# Yoga:
## .center[Demo of Attrition]


---
class: inverse, middle, center
# Yoga:
## .center[Extreme Values Bounds]

class: inverse, middle, center
# Review:
## .center[Extreme Values Bounds]



<!-- EASY TO GRAB FUNCTIONS -->

<!-- ```{r echo=FALSE, out.width='80%', fig.align='center'} -->
<!-- knitr::include_graphics(path='./figures/ ') -->
<!-- ``` -->


<!-- $$\widehat{Y}_{i} = \beta_{0} + \beta_{1} I_{i} + \beta_{2} P_{i} + \beta_{3} (I_{i} \times P_{i})$$ -->


<!-- $$\begin{aligned}  -->
<!--   T_{ijkm}(Y_{n})  = \alpha &+ \gamma T_{ijkm}(Y_{0}) + \delta_{1} Incentives_{i} \\  -->
<!--     & + \delta_{2} Characteristic_{i} \\  -->
<!--     & + \delta_{3} (Incentives_{i} \times Characteristic_{i}) \\  -->
<!--     & + \beta Z_{m} + \epsilon_{k} + \epsilon_{jk} + \epsilon_{ijk} -->
<!-- \end{aligned}$$ -->




